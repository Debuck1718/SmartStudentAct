<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="pageTitle">Reset Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="./images/icon.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./images/icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
  <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="absolute top-4 right-4 z-20">
    <select id="language-selector" class="bg-white border border-gray-300 rounded-lg p-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="en">English</option>
      <option value="fr">Fran√ßais</option>
      <option value="es">Espa√±ol</option>
      <option value="tr">T√ºrk√ße</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
    </select>
  </div>

  <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-8" id="form-container">
    <h2 id="form-title" class="text-2xl font-bold text-center text-gray-800 mb-6">Reset Your Password</h2>
    
    <form id="resetPasswordForm" class="space-y-4">
      <div>
        <label for="password" id="label-password" class="block text-gray-700 font-medium">New Password</label>
        <div class="relative">
          <input type="password" id="password" name="password" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 pr-10">
          <button type="button" onclick="togglePassword('password','togglePasswordIcon')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500">
            <i id="togglePasswordIcon" class="fas fa-eye"></i>
          </button>
        </div>
        <div id="passwordStrength" class="mt-2 text-sm font-medium"></div>
      </div>
      
      <div>
        <label for="confirmPassword" id="label-confirmPassword" class="block text-gray-700 font-medium">Confirm New Password</label>
        <div class="relative">
          <input type="password" id="confirmPassword" name="confirmPassword" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 pr-10">
          <button type="button" onclick="togglePassword('confirmPassword','toggleConfirmPasswordIcon')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500">
            <i id="toggleConfirmPasswordIcon" class="fas fa-eye"></i>
          </button>
        </div>
      </div>
      
      <button type="submit" id="submit-button" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">Update Password</button>
    </form>

    <div id="message" class="mt-4 text-center text-sm"></div>
  </div>

  <script>
    const translations = {
      en: {
        pageTitle: "Reset Password",
        formTitle: "Reset Your Password",
        labelPassword: "New Password",
        labelConfirmPassword: "Confirm New Password",
        submitButton: "Update Password",
        strength: {
          weak: "Weak ‚ùå (Add uppercase, special char, min 8 chars)",
          fair: "Fair ‚ö†Ô∏è (Add more variety for strength)",
          good: "Good ‚úÖ (Secure enough)",
          strong: "Strong üîí (Excellent!)"
        },
        errors: {
          invalidPassword: "‚ùå Password must be at least 8 characters, include uppercase & special char.",
          mismatch: "‚ùå Passwords do not match.",
          resetFail: "‚ùå Failed to reset password. Try again.",
          serverError: "‚ùå Something went wrong."
        },
        success: "‚úÖ Password updated successfully. You can now log in."
      },
      fr: {
        pageTitle: "R√©initialiser le mot de passe",
        formTitle: "R√©initialisez votre mot de passe",
        labelPassword: "Nouveau mot de passe",
        labelConfirmPassword: "Confirmer le nouveau mot de passe",
        submitButton: "Mettre √† jour le mot de passe",
        strength: {
          weak: "Faible ‚ùå (Ajouter majuscule, caract√®re sp√©cial, min 8 caract√®res)",
          fair: "Moyen ‚ö†Ô∏è (Ajoutez plus de vari√©t√©)",
          good: "Bon ‚úÖ (Assez s√©curis√©)",
          strong: "Fort üîí (Excellent!)"
        },
        errors: {
          invalidPassword: "‚ùå Le mot de passe doit contenir au moins 8 caract√®res, majuscule et caract√®re sp√©cial.",
          mismatch: "‚ùå Les mots de passe ne correspondent pas.",
          resetFail: "‚ùå √âchec de la r√©initialisation. R√©essayez.",
          serverError: "‚ùå Une erreur est survenue."
        },
        success: "‚úÖ Mot de passe mis √† jour avec succ√®s. Vous pouvez maintenant vous connecter."
      },
      es: {
        pageTitle: "Restablecer contrase√±a",
        formTitle: "Restablece tu contrase√±a",
        labelPassword: "Nueva contrase√±a",
        labelConfirmPassword: "Confirmar nueva contrase√±a",
        submitButton: "Actualizar contrase√±a",
        strength: {
          weak: "D√©bil ‚ùå (A√±ade may√∫scula, caracter especial, min 8 caracteres)",
          fair: "Regular ‚ö†Ô∏è (A√±ade m√°s variedad)",
          good: "Bueno ‚úÖ (Suficientemente seguro)",
          strong: "Fuerte üîí (Excelente!)"
        },
        errors: {
          invalidPassword: "‚ùå La contrase√±a debe tener al menos 8 caracteres, incluir may√∫scula y caracter especial.",
          mismatch: "‚ùå Las contrase√±as no coinciden.",
          resetFail: "‚ùå Fallo al restablecer. Intenta de nuevo.",
          serverError: "‚ùå Algo sali√≥ mal."
        },
        success: "‚úÖ Contrase√±a actualizada. Ya puedes iniciar sesi√≥n."
      },
      tr: {
        pageTitle: "≈ûifreyi Sƒ±fƒ±rla",
        formTitle: "≈ûifrenizi Sƒ±fƒ±rlayƒ±n",
        labelPassword: "Yeni ≈ûifre",
        labelConfirmPassword: "Yeni ≈ûifreyi Onayla",
        submitButton: "≈ûifreyi G√ºncelle",
        strength: {
          weak: "Zayƒ±f ‚ùå (B√ºy√ºk harf, √∂zel karakter, min 8 karakter ekleyin)",
          fair: "Orta ‚ö†Ô∏è (Daha fazla √ße≈üitlilik ekleyin)",
          good: "ƒ∞yi ‚úÖ (Yeterince g√ºvenli)",
          strong: "G√º√ßl√º üîí (M√ºkemmel!)"
        },
        errors: {
          invalidPassword: "‚ùå ≈ûifre en az 8 karakter, b√ºy√ºk harf ve √∂zel karakter i√ßermelidir.",
          mismatch: "‚ùå ≈ûifreler e≈üle≈ümiyor.",
          resetFail: "‚ùå Sƒ±fƒ±rlama ba≈üarƒ±sƒ±z. Tekrar deneyin.",
          serverError: "‚ùå Bir hata olu≈ütu."
        },
        success: "‚úÖ ≈ûifre ba≈üarƒ±yla g√ºncellendi. Artƒ±k giri≈ü yapabilirsiniz."
      },
      ar: {
        pageTitle: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
        formTitle: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÉ",
        labelPassword: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©",
        labelConfirmPassword: "ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©",
        submitButton: "ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
        strength: {
          weak: "ÿ∂ÿπŸäŸÅÿ© ‚ùå (ÿ£ÿ∂ŸÅ ÿ≠ÿ±ŸÅ ŸÉÿ®Ÿäÿ±ÿå ÿ±ŸÖÿ≤ ÿÆÿßÿµÿå 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ)",
          fair: "ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ‚ö†Ô∏è (ÿ£ÿ∂ŸÅ ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÜŸàÿπ)",
          good: "ÿ¨ŸäÿØÿ© ‚úÖ (ÿ¢ŸÖŸÜÿ© ÿ®ŸÖÿß ŸÅŸäŸá ÿßŸÑŸÉŸÅÿßŸäÿ©)",
          strong: "ŸÇŸàŸäÿ© üîí (ŸÖŸÖÿ™ÿßÿ≤!)"
        },
        errors: {
          invalidPassword: "‚ùå Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑÿå ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ≠ÿ±ŸÅ ŸÉÿ®Ÿäÿ± Ÿàÿ±ŸÖÿ≤ ÿÆÿßÿµ.",
          mismatch: "‚ùå ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©.",
          resetFail: "‚ùå ŸÅÿ¥ŸÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
          serverError: "‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÖÿß."
        },
        success: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ŸÜÿ¨ÿßÿ≠. ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ."
      },
      ru: {
        pageTitle: "–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è",
        formTitle: "–°–±—Ä–æ—Å—å—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å",
        labelPassword: "–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å",
        labelConfirmPassword: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å",
        submitButton: "–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å",
        strength: {
          weak: "–°–ª–∞–±—ã–π ‚ùå (–î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–ª–∞–≤–Ω—É—é, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª, –º–∏–Ω 8 —Å–∏–º–≤–æ–ª–æ–≤)",
          fair: "–°—Ä–µ–¥–Ω–∏–π ‚ö†Ô∏è (–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è)",
          good: "–•–æ—Ä–æ—à–∏–π ‚úÖ (–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ)",
          strong: "–°–∏–ª—å–Ω—ã–π üîí (–û—Ç–ª–∏—á–Ω–æ!)"
        },
        errors: {
          invalidPassword: "‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤, –≤–∫–ª—é—á–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—É—é –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª.",
          mismatch: "‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.",
          resetFail: "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
          serverError: "‚ùå –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫."
        },
        success: "‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏."
      }
    };

    const form = document.getElementById("resetPasswordForm");
    const passwordInput = document.getElementById("password");
    const passwordStrength = document.getElementById("passwordStrength");
    const messageDiv = document.getElementById("message");
    const languageSelector = document.getElementById("language-selector");

    let currentLang = "en";

    function translatePage(lang){
      currentLang = lang;
      const t = translations[lang];
      document.title = t.pageTitle;
      document.getElementById("form-title").textContent = t.formTitle;
      document.getElementById("label-password").textContent = t.labelPassword;
      document.getElementById("label-confirmPassword").textContent = t.labelConfirmPassword;
      document.getElementById("submit-button").textContent = t.submitButton;
      passwordStrength.textContent = "";
      messageDiv.textContent = "";
    }

    languageSelector.addEventListener("change", e => translatePage(e.target.value));
    translatePage(currentLang);

    function validatePassword(password){
      return /^(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/.test(password);
    }
    
    function checkStrength(password) {
      let score = 0;
      if (password.length >= 8) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;

      switch (score) {
        case 0:
        case 1:
          passwordStrength.textContent = "Weak ‚ùå (Add uppercase, special char, min 8 chars)";
          passwordStrength.className = "mt-2 text-red-600 text-sm font-medium";
          break;
        case 2:
          passwordStrength.textContent = "Fair ‚ö†Ô∏è (Add more variety for strength)";
          passwordStrength.className = "mt-2 text-yellow-600 text-sm font-medium";
          break;
        case 3:
          passwordStrength.textContent = "Good ‚úÖ (Secure enough)";
          passwordStrength.className = "mt-2 text-green-600 text-sm font-medium";
          break;
        case 4:
          passwordStrength.textContent = "Strong üîí (Excellent!)";
          passwordStrength.className = "mt-2 text-green-700 text-sm font-bold";
          break;
      }
    }

    passwordInput.addEventListener("input", () => {
      checkStrength(passwordInput.value);
    });

    function togglePassword(inputId, iconId) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById(iconId);
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token"); // token from reset email link

      const password = document.getElementById("password").value.trim();
      const confirmPassword = document.getElementById("confirmPassword").value.trim();

      if (!validatePassword(password)) {
        messageDiv.textContent = "‚ùå Password must be at least 8 characters long, include an uppercase letter and a special character.";
        messageDiv.className = "mt-4 text-center text-red-600";
        return;
      }

      if (password !== confirmPassword) {
        messageDiv.textContent = "‚ùå Passwords do not match.";
        messageDiv.className = "mt-4 text-center text-red-600";
        return;
      }

      try {
        const response = await fetch("https://smartstudentact.onrender.com/api/reset-password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, password })
        });

        const data = await response.json();
        if (response.ok) {
          messageDiv.textContent = "‚úÖ Password updated successfully. You can now log in.";
          messageDiv.className = "mt-4 text-center text-green-600";
          form.reset();
          passwordStrength.textContent = "";
        } else {
          messageDiv.textContent = "‚ùå " + (data.error || "Something went wrong.");
          messageDiv.className = "mt-4 text-center text-red-600";
        }
      } catch (err) {
        console.error(err);
        messageDiv.textContent = "‚ùå Failed to reset password. Try again.";
        messageDiv.className = "mt-4 text-center text-red-600";
      }
    });
  </script>
</body>
</html>

