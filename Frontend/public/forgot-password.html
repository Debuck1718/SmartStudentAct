<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="pageTitle">Reset Your Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f5f5f5;
      }
      .full-screen-container {
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 80%;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Language Selector -->
    <div class="absolute top-4 right-4 z-20">
      <select
        id="language-selector"
        class="bg-white border border-gray-300 rounded-lg p-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="es">Español</option>
        <option value="tr">Türkçe</option>
        <option value="ar">العربية</option>
        <option value="ru">Русский</option>
      </select>
    </div>

    <!-- Modal -->
    <div id="alert-modal" class="modal">
      <div class="modal-content shadow-lg">
        <h3 id="modal-title" class="text-xl font-bold mb-4"></h3>
        <p id="modal-message" class="mb-6"></p>
        <button
          onclick="closeModal()"
          class="bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors"
        >
          OK
        </button>
      </div>
    </div>

    <!-- Main Container -->
    <div class="full-screen-container">
      <div class="w-full max-w-sm p-8 bg-white rounded-lg shadow-md">
        <h1
          id="page-title"
          class="text-2xl font-bold text-center text-gray-800 mb-4"
          data-i18n="pageTitle"
        >
          Reset Your Password
        </h1>
        <p
          id="page-description"
          class="text-gray-600 text-center mb-6"
          data-i18n="description"
        >
          Enter your email to receive reset instructions.
        </p>

        <input
          id="emailInput"
          type="email"
          placeholder="Your email"
          class="w-full h-12 mb-4 px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
          data-i18n-placeholder="emailPlaceholder"
        />

        <button
          id="resetButton"
          class="w-full py-3 px-4 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center min-h-[48px]"
          data-i18n="resetButton"
        >
          Send Reset Link
        </button>

        <button
          id="backButton"
          class="w-full mt-4 py-2 text-blue-600 font-semibold hover:underline"
          data-i18n="backButton"
        >
          Back to Login
        </button>
      </div>
    </div>

    <script>
      const translations = {
        en: {
          pageTitle: "Reset Your Password",
          description: "Enter your email to receive reset instructions.",
          emailPlaceholder: "Your email",
          resetButton: "Send Reset Link",
          backButton: "Back to Login",
          alertInvalidEmail: "Please enter a valid email address.",
          alertSuccess:
            "If an account with {email} exists, a password reset link has been sent.",
          alertResetFailed: "Could not process your request.",
          networkError: "Could not connect to the server.",
        },
        fr: {
          pageTitle: "Réinitialisez votre mot de passe",
          description:
            "Entrez votre e-mail pour recevoir les instructions de réinitialisation.",
          emailPlaceholder: "Votre e-mail",
          resetButton: "Envoyer le lien de réinitialisation",
          backButton: "Retour à la connexion",
          alertInvalidEmail: "Veuillez entrer une adresse e-mail valide.",
          alertSuccess:
            "Si un compte avec {email} existe, un lien de réinitialisation a été envoyé.",
          alertResetFailed: "Impossible de traiter votre demande.",
          networkError: "Impossible de se connecter au serveur.",
        },
        es: {
          pageTitle: "Restablecer contraseña",
          description:
            "Ingrese su correo electrónico para recibir instrucciones de restablecimiento.",
          emailPlaceholder: "Su correo electrónico",
          resetButton: "Enviar enlace de restablecimiento",
          backButton: "Volver al inicio de sesión",
          alertInvalidEmail: "Por favor ingrese un correo electrónico válido.",
          alertSuccess:
            "Si existe una cuenta con {email}, se ha enviado un enlace de restablecimiento.",
          alertResetFailed: "No se pudo procesar su solicitud.",
          networkError: "No se pudo conectar al servidor.",
        },
        tr: {
          pageTitle: "Şifrenizi Sıfırlayın",
          description: "Sıfırlama talimatlarını almak için e-postanızı girin.",
          emailPlaceholder: "E-postanız",
          resetButton: "Sıfırlama Bağlantısı Gönder",
          backButton: "Girişe Dön",
          alertInvalidEmail: "Lütfen geçerli bir e-posta adresi girin.",
          alertSuccess:
            "{email} adresine sahip bir hesap varsa, bir sıfırlama bağlantısı gönderildi.",
          alertResetFailed: "İsteğiniz işlenemedi.",
          networkError: "Sunucuya bağlanılamıyor.",
        },
        ar: {
          pageTitle: "إعادة تعيين كلمة المرور",
          description: "أدخل بريدك الإلكتروني لتلقي تعليمات إعادة التعيين.",
          emailPlaceholder: "بريدك الإلكتروني",
          resetButton: "إرسال رابط إعادة التعيين",
          backButton: "العودة لتسجيل الدخول",
          alertInvalidEmail: "يرجى إدخال بريد إلكتروني صالح.",
          alertSuccess:
            "إذا كان هناك حساب مرتبط بـ {email}، تم إرسال رابط إعادة التعيين.",
          alertResetFailed: "تعذر معالجة طلبك.",
          networkError: "تعذر الاتصال بالخادم.",
        },
        ru: {
          pageTitle: "Сбросить пароль",
          description:
            "Введите свой адрес электронной почты, чтобы получить инструкции по сбросу.",
          emailPlaceholder: "Ваш email",
          resetButton: "Отправить ссылку для сброса",
          backButton: "Назад к входу",
          alertInvalidEmail:
            "Пожалуйста, введите корректный адрес электронной почты.",
          alertSuccess:
            "Если учетная запись с {email} существует, ссылка для сброса пароля была отправлена.",
          alertResetFailed: "Не удалось обработать ваш запрос.",
          networkError: "Не удалось подключиться к серверу.",
        },
      };

      // DOM elements
      const emailInput = document.getElementById("emailInput");
      const resetButton = document.getElementById("resetButton");
      const backButton = document.getElementById("backButton");
      const langSelector = document.getElementById("language-selector");
      const modal = document.getElementById("alert-modal");
      const modalTitle = document.getElementById("modal-title");
      const modalMessage = document.getElementById("modal-message");

      let currentLang = "en";
      let redirectOnClose = false;

      // Translate page
      function translatePage(lang) {
        currentLang = lang;
        const t = translations[lang];
        document.documentElement.lang = lang;
        document.title = t.pageTitle;
        document.getElementById("page-title").textContent = t.pageTitle;
        document.getElementById("page-description").textContent = t.description;
        emailInput.placeholder = t.emailPlaceholder;
        resetButton.textContent = t.resetButton;
        backButton.textContent = t.backButton;
      }

      // Modal functions
      function showAlert(title, message, redirect = false) {
        modalTitle.textContent = title;
        modalMessage.textContent = message;
        redirectOnClose = redirect;
        modal.style.display = "flex";
      }

      function closeModal() {
        modal.style.display = "none";
        if (redirectOnClose) window.location.href = "/login.html";
      }

      // Handle reset
      async function handleReset() {
        const t = translations[currentLang];
        const email = emailInput.value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(email)) {
          showAlert(t.alertInvalidEmail, "");
          return;
        }

        resetButton.disabled = true;
        backButton.disabled = true;
        emailInput.disabled = true;
        resetButton.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

        try {
          const response = await fetch(`${API_BASE_URL}/auth/forgot-password`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const result = await response.json();
          showAlert(
            "Success",
            result.message || t.alertSuccess.replace("{email}", email),
            true
          );
        } catch (e) {
          console.error(e);
          showAlert("Error", translations[currentLang].alertResetFailed);
        } finally {
          resetButton.disabled = false;
          backButton.disabled = false;
          emailInput.disabled = false;
          resetButton.textContent = translations[currentLang].resetButton;
        }
      }

      // Event listeners
      resetButton.addEventListener("click", handleReset);
      emailInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleReset();
      });
      backButton.addEventListener(
        "click",
        () => (window.location.href = "/login.html")
      );
      langSelector.addEventListener("change", (e) =>
        translatePage(e.target.value)
      );

      // Initial translation
      document.addEventListener("DOMContentLoaded", () => {
        const userLang = navigator.language.split("-")[0];
        if (translations[userLang]) langSelector.value = userLang;
        translatePage(langSelector.value);
      });
    </script>
  </body>
</html>
