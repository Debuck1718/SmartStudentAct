<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page_title">AI Essay Checker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .cta-button { background-image: linear-gradient(to right, #4c51bf 0%, #667eea 100%); transition: all 0.3s ease; }
        .cta-button:hover { transform: translateY(-2px); box-shadow: 0 4px 14px 0 rgba(102, 126, 234, 0.4); }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; width: 1.5rem; height: 1.5rem; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .language-switcher button { margin-right: 0.5rem; padding: 0.5rem 1rem; border-radius: 0.5rem; color: white; font-weight: 600; }
        .language-switcher button.active { text-decoration: underline; transform: scale(1.1); }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8 flex justify-center items-center min-h-screen">

    <!-- Language Switcher -->
    <div class="language-switcher mb-6">
        <button id="en-btn" onclick="setLanguage('en')" class="bg-blue-500">English</button>
        <button id="fr-btn" onclick="setLanguage('fr')" class="bg-blue-500">Français</button>
        <button id="es-btn" onclick="setLanguage('es')" class="bg-blue-500">Español</button>
        <button id="tr-btn" onclick="setLanguage('tr')" class="bg-blue-500">Türkçe</button>
        <button id="ar-btn" onclick="setLanguage('ar')" class="bg-blue-500">العربية</button>
        <button id="ru-btn" onclick="setLanguage('ru')" class="bg-blue-500">Русский</button>
    </div>

    <div class="w-full max-w-5xl app-container p-6 md:p-12 rounded-2xl shadow-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2 md:mb-4" data-i18n="header">AI Essay Checker ✍️</h1>
        <p class="text-center text-gray-500 mb-6 md:mb-8" data-i18n="description">Get instant feedback on your essay's grammar, structure, and style.</p>

        <div class="flex justify-between items-center text-sm font-medium text-gray-500 mb-4">
            <span id="word-count">0 words</span>
            <span id="word-limit" class="text-gray-400">/ 1000 words max</span>
        </div>

        <form id="essay-form" class="flex flex-col gap-4">
            <textarea
                id="essay-text"
                class="w-full h-80 p-4 md:p-6 border border-gray-300 rounded-xl shadow-inner 
                       focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                placeholder=""
                required
                data-i18n-placeholder="essay_placeholder"
            ></textarea>
            
            <button
                type="submit"
                id="submit-button"
                class="w-full px-6 py-4 text-lg font-semibold rounded-xl shadow-lg transition-all duration-300
                       text-white cta-button flex items-center justify-center min-h-[50px] disabled:opacity-50 disabled:cursor-not-allowed"
                data-i18n="submit_btn"
            >
            </button>
        </form>

        <div id="status-message" class="mt-6 text-center hidden"></div>

        <div id="feedback-container" class="mt-8 space-y-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4" data-i18n="feedback_header">Feedback</h2>
            <div id="feedback-content" class="space-y-6"></div>
            <button id="copy-button" class="mt-4 w-full py-3 px-6 text-base font-medium rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors shadow-md hidden" data-i18n="copy_btn">
                Copy Feedback to Clipboard
            </button>
        </div>
    </div>

    <script>

                const translations = {
            en: {
                page_title: "AI Essay Checker",
                header: "AI Essay Checker ✍️",
                description: "Get instant feedback on your essay's grammar, structure, and style.",
                essay_placeholder: "Paste your essay here... (1000 words max)",
                submit_btn: "Get Feedback",
                feedback_header: "Feedback",
                copy_btn: "Copy Feedback to Clipboard",
                processing: "Processing your essay..."
            },
            fr: {
                page_title: "Correcteur de Rédaction IA",
                header: "Correcteur de Rédaction IA ✍️",
                description: "Obtenez des retours instantanés sur la grammaire, la structure et le style de votre essai.",
                essay_placeholder: "Collez votre essai ici... (1000 mots max)",
                submit_btn: "Obtenir des retours",
                feedback_header: "Retour",
                copy_btn: "Copier le retour",
                processing: "Traitement de votre essai..."
            },
            es: {
                page_title: "Corrector de Ensayos IA",
                header: "Corrector de Ensayos IA ✍️",
                description: "Obtén retroalimentación instantánea sobre la gramática, la estructura y el estilo de tu ensayo.",
                essay_placeholder: "Pega tu ensayo aquí... (máx. 1000 palabras)",
                submit_btn: "Obtener retroalimentación",
                feedback_header: "Retroalimentación",
                copy_btn: "Copiar retroalimentación",
                processing: "Procesando tu ensayo..."
            },
            tr: {
                page_title: "Yapay Zeka Makale Kontrolü",
                header: "Yapay Zeka Makale Kontrolü ✍️",
                description: "Makalelerinizin dil bilgisi, yapı ve üslubu hakkında anında geri bildirim alın.",
                essay_placeholder: "Makaleyi buraya yapıştırın... (maks. 1000 kelime)",
                submit_btn: "Geri Bildirim Al",
                feedback_header: "Geri Bildirim",
                copy_btn: "Geri Bildirimi Kopyala",
                processing: "Makaleni işliyoruz..."
            },
            ar: {
                page_title: "مدقق المقالات بالذكاء الاصطناعي",
                header: "مدقق المقالات بالذكاء الاصطناعي ✍️",
                description: "احصل على ملاحظات فورية حول القواعد، الهيكل والأسلوب لمقالك.",
                essay_placeholder: "ألصق مقالك هنا... (1000 كلمة كحد أقصى)",
                submit_btn: "احصل على الملاحظات",
                feedback_header: "التغذية الراجعة",
                copy_btn: "نسخ الملاحظات",
                processing: "جارٍ معالجة مقالك..."
            },
            ru: {
                page_title: "Проверка эссе ИИ",
                header: "Проверка эссе ИИ ✍️",
                description: "Получите мгновенные отзывы о грамматике, структуре и стиле вашего эссе.",
                essay_placeholder: "Вставьте ваше эссе сюда... (макс. 1000 слов)",
                submit_btn: "Получить отзыв",
                feedback_header: "Обратная связь",
                copy_btn: "Скопировать отзыв",
                processing: "Обработка вашего эссе..."
            }
        };

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.textContent = translations[lang][key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) el.placeholder = translations[lang][key];
            });
            document.querySelectorAll('.language-switcher button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${lang}-btn`).classList.add('active');
            document.documentElement.lang = lang;
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }
       
        const essayForm = document.getElementById('essay-form');
        const essayTextarea = document.getElementById('essay-text');
        const submitButton = document.getElementById('submit-button');
        const statusMessageDiv = document.getElementById('status-message');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackContentDiv = document.getElementById('feedback-content');
        const copyButton = document.getElementById('copy-button');
        const wordCountSpan = document.getElementById('word-count');
        const wordLimitSpan = document.getElementById('word-limit');

        // Configuration
        const MAX_WORDS = 1000;
        const API_KEY = ""; // Do not change. The platform will provide this at runtime.

        // State variables
        let isLoading = false;
        
        // Function to update the word count display
        function updateWordCount() {
            const text = essayTextarea.value;
            const words = text.split(/\s+/).filter(word => word.length > 0);
            const count = words.length;
            
            wordCountSpan.textContent = `${count} words`;
            
            if (count > MAX_WORDS) {
                wordCountSpan.classList.add('text-red-500');
                wordLimitSpan.classList.add('text-red-500');
                submitButton.disabled = true;
            } else {
                wordCountSpan.classList.remove('text-red-500');
                wordLimitSpan.classList.remove('text-red-500');
                submitButton.disabled = false;
            }
        }

        // Add event listener for real-time word count
        essayTextarea.addEventListener('input', updateWordCount);

        // Function to display messages (loading, error)
        function showStatus(message, type) {
            statusMessageDiv.textContent = message;
            statusMessageDiv.classList.remove('hidden', 'text-red-500', 'text-blue-500');
            statusMessageDiv.classList.add('p-3', 'rounded-lg');
            
            if (type === 'loading') {
                statusMessageDiv.classList.add('text-blue-600', 'animate-pulse');
                submitButton.disabled = true;
                submitButton.innerHTML = `<div class="spinner"></div>`;
            } else if (type === 'error') {
                statusMessageDiv.classList.add('text-red-500');
                submitButton.disabled = false;
                submitButton.innerHTML = `Get Feedback`;
            } else if (type === 'success') {
                 statusMessageDiv.classList.add('text-green-500');
                 submitButton.disabled = false;
                 submitButton.innerHTML = `Get Feedback`;
            } else {
                statusMessageDiv.classList.remove('p-3', 'rounded-lg');
            }
        }

        // Function to render the feedback sections dynamically from a JSON object
        function renderFeedback(feedback) {
            feedbackContentDiv.innerHTML = ''; // Clear previous feedback
            feedbackContainer.classList.remove('hidden');
            copyButton.classList.remove('hidden');

            const sections = [
                { key: 'thesis_statement_feedback', title: 'Thesis Statement', icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" /></svg>` },
                { key: 'structure_feedback', title: 'Structure & Flow', icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>` },
                { key: 'grammar_and_spelling_feedback', title: 'Grammar & Spelling', icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2-7a2 2 0 012 2v4a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h4a2 2 0 012 2z" /></svg>` },
                { key: 'style_and_tone_feedback', title: 'Style & Tone', icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.586a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>` },
                { key: 'summary_and_next_steps', title: 'Summary & Next Steps', icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>` }
            ];

            sections.forEach(section => {
                const feedbackItems = feedback[section.key];
                if (feedbackItems) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'bg-white p-6 rounded-xl border border-gray-200 shadow-lg fade-in';
                    sectionDiv.innerHTML = `<h3 class="flex items-center text-xl font-semibold text-gray-700 mb-4">${section.icon} ${section.title}</h3>`;
                    
                    if (feedbackItems.length > 0) {
                        const ul = document.createElement('ul');
                        ul.className = 'list-disc list-inside space-y-2 text-gray-600';
                        feedbackItems.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            ul.appendChild(li);
                        });
                        sectionDiv.appendChild(ul);
                    } else {
                        const p = document.createElement('p');
                        p.className = 'text-gray-500 italic';
                        p.textContent = 'No issues found. Excellent!';
                        sectionDiv.appendChild(p);
                    }
                    feedbackContentDiv.appendChild(sectionDiv);
                }
            });
        }

        // --- Core Logic for AI Integration and API Call ---
        async function getEssayFeedback(essayText) {
            const prompt = `You are a helpful and detailed academic essay checker. Analyze the following essay and provide constructive feedback in a structured JSON format. The user's essay is:\n\n---\n${essayText}\n---\n\nProvide feedback for the following categories:\n1. thesis_statement_feedback: A clear evaluation of the thesis statement.\n2. structure_feedback: Comments on the essay's paragraph structure and logical flow.\n3. grammar_and_spelling_feedback: Identify any grammatical errors or typos. Do not just list corrections, but explain the rules or reasons.\n4. style_and_tone_feedback: Suggestions for improving the writing style and tone to be more academic or persuasive.\n5. summary_and_next_steps: A brief summary of the overall essay's strengths and a clear list of next steps for revision.\n\nYour response MUST be a single JSON object with the following schema:\n{\n  "thesis_statement_feedback": ["string"],\n  "structure_feedback": ["string"],\n  "grammar_and_spelling_feedback": ["string"],\n  "style_and_tone_feedback": ["string"],\n  "summary_and_next_steps": ["string"]\n}\n\nDo not include any other text or formatting outside of the JSON object.`;

            const payload = {
                contents: [{
                    role: "user",
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "thesis_statement_feedback": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "structure_feedback": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "grammar_and_spelling_feedback": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "style_and_tone_feedback": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "summary_and_next_steps": { "type": "ARRAY", "items": { "type": "STRING" } }
                        },
                        "propertyOrdering": ["thesis_statement_feedback", "structure_feedback", "grammar_and_spelling_feedback", "style_and_tone_feedback", "summary_and_next_steps"]
                    }
                }
            };
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

            let response;
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error.message || 'API request failed.');
                }

                const result = await response.json();
                const json = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!json) {
                    throw new Error('No valid JSON response from API.');
                }
                return JSON.parse(json);

            } catch (error) {
                console.error('API call failed:', error);
                throw new Error(`API call failed: ${error.message}`);
            }
        }

        // Event listener for the form submission
        essayForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Hide previous results
            feedbackContainer.classList.add('hidden');
            copyButton.classList.add('hidden');

            const essayText = essayTextarea.value.trim();
            if (!essayText) {
                showStatus('Please enter an essay to check.', 'error');
                return;
            }

            showStatus('Analyzing your essay...', 'loading');
            
            try {
                // Here, we call the new AI function with the essay text.
                const feedback = await getEssayFeedback(essayText);
                renderFeedback(feedback);
                showStatus('Feedback generated successfully!', 'success');
            } catch (error) {
                console.error('An error occurred:', error);
                showStatus(error.message, 'error');
            } finally {
                // The status message is updated in the try/catch blocks, so we don't need to hide it here.
            }
        });
        
        // Copy feedback to clipboard functionality
        copyButton.addEventListener('click', () => {
            let feedbackText = "Essay Feedback:\n\n";
            const feedbackSections = document.querySelectorAll('#feedback-content > div');
            feedbackSections.forEach(section => {
                const title = section.querySelector('h3').textContent.trim();
                feedbackText += `--- ${title} ---\n`;
                const listItems = section.querySelectorAll('li');
                if (listItems.length > 0) {
                    listItems.forEach(item => {
                        feedbackText += `- ${item.textContent.trim()}\n`;
                    });
                } else {
                    feedbackText += `No issues found. Excellent!\n`;
                }
                feedbackText += '\n';
            });
            
            navigator.clipboard.writeText(feedbackText)
                .then(() => {
                    copyButton.textContent = 'Copied!';
                    setTimeout(() => {
                        copyButton.textContent = 'Copy Feedback to Clipboard';
                    }, 2000);
                })
                .catch(err => {
                    console.error('Could not copy text: ', err);
                });
        });

        // Initial call to set up the uses counter (from original code, kept for consistency)
        updateWordCount();
    </script>
</body>
</html>
