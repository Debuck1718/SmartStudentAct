<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teachers List</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    /* Skeleton Loader */
    .skeleton { 
      background-color: #e0e0e0; 
      border-radius: 8px; 
      min-height: 60px; 
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">

  <main class="w-full max-w-2xl p-4 sm:p-6 lg:p-8">
    <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 my-8">Teachers in Your School</h1>

    <!-- Loading Skeleton -->
    <div id="loading-skeleton" class="space-y-4">
      <div class="skeleton w-full h-20"></div>
      <div class="skeleton w-full h-20"></div>
      <div class="skeleton w-full h-20"></div>
    </div>

    <!-- Error and Empty Messages -->
    <div id="error-message" class="text-center text-red-500 font-medium py-4 hidden" role="alert"></div>
    <div id="no-teachers-message" class="text-center text-gray-500 font-medium py-4 hidden">No teachers found in your school.</div>

    <!-- Teachers List -->
    <div id="teachers-list" class="space-y-4"></div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const teachersList = document.getElementById('teachers-list');
      const loadingSkeleton = document.getElementById('loading-skeleton');
      const errorMessage = document.getElementById('error-message');
      const noTeachersMessage = document.getElementById('no-teachers-message');

      // Helper: render single teacher card
      const renderTeacherItem = (teacher) => {
        const card = document.createElement('div');
        card.classList.add(
          'bg-white', 'p-4', 'rounded-lg', 'border', 'border-gray-200', 
          'shadow-sm', 'hover:shadow-md', 'transition-shadow'
        );
        card.setAttribute('aria-label', `Teacher ${teacher.firstName} ${teacher.lastName}, Subject: ${teacher.teacherSubject}`);
        
        const nameEl = document.createElement('p');
        nameEl.textContent = `${teacher.firstName} ${teacher.lastName}`;
        nameEl.classList.add('text-lg', 'font-semibold', 'text-gray-800');

        const subjectEl = document.createElement('p');
        subjectEl.textContent = `Subject: ${teacher.teacherSubject || 'Not Specified'}`;
        subjectEl.classList.add('text-sm', 'text-gray-600', 'mt-1');

        const emailEl = document.createElement('a');
        emailEl.href = `mailto:${teacher.email}`;
        emailEl.textContent = teacher.email;
        emailEl.classList.add('text-sm', 'text-blue-600', 'hover:underline', 'mt-1', 'block');
        emailEl.setAttribute('aria-label', `Email ${teacher.firstName} ${teacher.lastName}`);

        card.appendChild(nameEl);
        card.appendChild(subjectEl);
        card.appendChild(emailEl);
        teachersList.appendChild(card);
      };

      // Fetch teachers for student
      const fetchTeachers = async () => {
        // Reset UI
        teachersList.innerHTML = '';
        errorMessage.classList.add('hidden');
        noTeachersMessage.classList.add('hidden');
        loadingSkeleton.classList.remove('hidden');

        try {
          const response = await fetch('/api/student/teachers/my-school', {
            method: 'GET',
            credentials: 'include', // httpOnly cookie authentication
            headers: { 'Content-Type': 'application/json' } 
          });

          if (!response.ok) {
            if (response.status === 401) throw new Error('Unauthorized: Please log in.');
            if (response.status === 403) throw new Error('Forbidden: You do not have permission.');
            throw new Error(`HTTP error: ${response.status}`);
          }

          const data = await response.json();

          if (data.teachers && Array.isArray(data.teachers)) {
            if (data.teachers.length === 0) {
              noTeachersMessage.classList.remove('hidden');
            } else {
              data.teachers.forEach(renderTeacherItem);
            }
          } else {
            throw new Error('Invalid data format received from API.');
          }
        } catch (err) {
          console.error('Failed to fetch teachers:', err);
          errorMessage.textContent = `Failed to load teachers: ${err.message}`;
          errorMessage.classList.remove('hidden');
        } finally {
          loadingSkeleton.classList.add('hidden');
        }
      };

      fetchTeachers();
    });
  </script>
</body>
</html>
