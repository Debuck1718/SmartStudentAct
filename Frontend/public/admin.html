<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./images/icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./images/icon.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }

      .container {
        padding: 20px;
        background-color: #f5f7fa;
        min-height: 100vh;
      }

      .loading-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #f5f7fa;
      }

      .action-button:active,
      .logout-button:active,
      .header-icon:active,
      .lang-button:active {
        transform: scale(0.98);
      }

      .picker-container {
        border-width: 1px;
        border-color: #ccc;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 10px;
        background-color: #fff;
        position: relative;
      }

      .picker-container::after {
        content: "\f078";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: #4b5563;
      }

      .picker {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        height: 50px;
        width: 100%;
        background-color: transparent;
        padding: 0 15px;
        font-size: 16px;
        color: #4b5563;
      }

      .tab-button {
        padding: 10px 15px;
        font-weight: 600;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: border-color 0.3s;
      }

      .tab-button.active {
        border-bottom-color: #3b82f6; 
      }
    </style>
  </head>
  <body class="bg-gray-100 antialiased">
    <div id="app-container" class="container"></div>

    <div
      id="alert-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center p-4"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
        <h3 id="alert-title" class="font-bold text-lg mb-2"></h3>
        <p id="alert-message" class="text-sm text-gray-700 mb-4"></p>
        <div class="flex justify-end space-x-2">
          <button
            id="alert-cancel"
            class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300"
          >
            Cancel
          </button>
          <button
            id="alert-confirm"
            class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <!-- Contact Form Modal -->
    <div
      id="contactModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center"
    >
      <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">📩 <span id="contact-title">Contact Us</span></h2>
        <form id="contactForm" class="space-y-4">
          <div>
            <label id="contact-name-label" class="block text-sm font-medium">Your Name</label>
            <input
              type="text"
              id="contactName"
              required
              class="w-full border rounded p-2"
            />
          </div>
          <div>
            <label id="contact-email-label" class="block text-sm font-medium">Your Email</label>
            <input
              type="email"
              id="contactEmail"
              required
              class="w-full border rounded p-2"
            />
          </div>
          <div>
            <label id="contact-message-label" class="block text-sm font-medium">Message</label>
            <textarea
              id="contactMessage"
              rows="4"
              required
              class="w-full border rounded p-2"
            ></textarea>
          </div>
          <div class="flex justify-end gap-2">
            <button
              type="button"
              id="closeContact"
              class="bg-gray-200 px-4 py-2 rounded"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded"
            >
              Send
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const API_BASE_URL = 'https://smartstudentact.onrender.com/api';

      const router = {
        replace: (path) => (window.location.href = path),
        push: (path) => (window.location.href = path),
      };

      
      const translations = {
        en: {
          title: "Admin Dashboard",
          loading: "Loading dashboard...",
          logout: "Logout",
          manageUsers: "Manage Users",
          manageFiles: "Manage Files",
          filters: "Filters",
          searchLabel: "Search by Name/Email:",
          searchPlaceholder: "Search...",
          gradeFilterLabel: "Filter by Grade:",
          allGrades: "All Grades",
          upperGrade: "Upper Grade (Class 5-6)",
          grade: "Grade",
          juniorHigh: "Junior High (Form 1-3)",
          seniorHigh: "Senior High (SHS 1-3)",
          university: "University",
          level: "Level",
          firstYear: "(First Year)",
          secondYear: "(Second Year)",
          thirdYear: "(Third Year)",
          finalYear: "(Final Year)",
          usersHeading: (count) => `Users (${count})`,
          noUsers: "No users found matching filters.",
          role: "Role",
          school: "School",
          gradeText: "Grade",
          promote: "Promote",
          demote: "Demote",
          suspend: "Suspend",
          delete: "Delete",
          note: "Note:",
          noteText: "You can only manage users from your school.",
          filesHeading: "Files from Your School",
          noFiles: "No files found for your school.",
          type: "Type",
          submittedBy: "Submitted By",
          viewFile: "View File",
          alert: {
            title: "",
            message: "",
            cancel: "Cancel",
            ok: "OK",
            logoutConfirmTitle: "Logout",
            logoutConfirmMessage: "Are you sure you want to log out?",
            logoutErrorTitle: "Logout Error",
            logoutErrorMessage: "Failed to log out. Please try again.",
            sessionExpiredTitle: "Session Expired",
            sessionExpiredMessage: "Your session has expired. Please log in again.",
            loadUsersError: "Failed to load user data.",
            loadFilesError: "Failed to load files from your school.",
            promoteUserTitle: "Promote User",
            promoteUserMessage: "Are you sure you want to promote this user?",
            demoteUserTitle: "Demote User",
            demoteUserMessage: "Are you sure you want to demote this user?",
            suspendUserTitle: "Suspend User",
            suspendUserMessage: "Are you sure you want to suspend this user?",
            deleteUserTitle: "Delete User",
            deleteUserMessage: "Are you sure you want to delete this user?",
            accessDeniedTitle: "Access Denied",
            accessDeniedMessage: "You do not have permission to view this page.",
            authFailedTitle: "Authentication Failed",
            authFailedMessage: "Please log in to continue.",
            sessionErrorTitle: "Session Error",
            sessionErrorMessage: "Could not verify session. Please log in again.",
            confirmDeleteTitle: "Confirm Delete",
            confirmDeleteMessage: (userName) => `Are you sure you want to delete ${userName}? This action cannot be undone.`,
            generalError: (action) => `Something went wrong while trying to ${action} the user.`,
            apiFailed: (message) => message || "API request failed.",
            successTitle: "Success",
            sendSuccess: "✅ Message sent successfully!",
            sendError: "❌ Could not send message. Try again later."
          },
          contactForm: {
            title: "Contact Us",
            nameLabel: "Your Name",
            emailLabel: "Your Email",
            messageLabel: "Message",
            cancel: "Cancel",
            send: "Send"
          }
        },
        fr: {
          title: "Tableau de bord de l'administrateur",
          loading: "Chargement du tableau de bord...",
          logout: "Déconnexion",
          manageUsers: "Gérer les utilisateurs",
          manageFiles: "Gérer les fichiers",
          filters: "Filtres",
          searchLabel: "Rechercher par nom/e-mail :",
          searchPlaceholder: "Rechercher...",
          gradeFilterLabel: "Filtrer par niveau :",
          allGrades: "Tous les niveaux",
          upperGrade: "Niveau supérieur (Classe 5-6)",
          grade: "Niveau",
          juniorHigh: "Collège (Form 1-3)",
          seniorHigh: "Lycée (SHS 1-3)",
          university: "Université",
          level: "Niveau",
          firstYear: "(Première année)",
          secondYear: "(Deuxième année)",
          thirdYear: "(Troisième année)",
          finalYear: "(Dernière année)",
          usersHeading: (count) => `Utilisateurs (${count})`,
          noUsers: "Aucun utilisateur trouvé correspondant aux filtres.",
          role: "Rôle",
          school: "École",
          gradeText: "Niveau",
          promote: "Promouvoir",
          demote: "Rétrograder",
          suspend: "Suspendre",
          delete: "Supprimer",
          note: "Note :",
          noteText: "Vous ne pouvez gérer que les utilisateurs de votre école.",
          filesHeading: "Fichiers de votre école",
          noFiles: "Aucun fichier trouvé pour votre école.",
          type: "Type",
          submittedBy: "Soumis par",
          viewFile: "Voir le fichier",
          alert: {
            title: "",
            message: "",
            cancel: "Annuler",
            ok: "OK",
            logoutConfirmTitle: "Déconnexion",
            logoutConfirmMessage: "Êtes-vous sûr de vouloir vous déconnecter ?",
            logoutErrorTitle: "Erreur de déconnexion",
            logoutErrorMessage: "Échec de la déconnexion. Veuillez réessayer.",
            sessionExpiredTitle: "Session expirée",
            sessionExpiredMessage: "Votre session a expiré. Veuillez vous reconnecter.",
            loadUsersError: "Échec du chargement des données utilisateur.",
            loadFilesError: "Échec du chargement des fichiers de votre école.",
            promoteUserTitle: "Promouvoir l'utilisateur",
            promoteUserMessage: "Êtes-vous sûr de vouloir promouvoir cet utilisateur ?",
            demoteUserTitle: "Rétrograder l'utilisateur",
            demoteUserMessage: "Êtes-vous sûr de vouloir rétrograder cet utilisateur ?",
            suspendUserTitle: "Suspendre l'utilisateur",
            suspendUserMessage: "Êtes-vous sûr de vouloir suspendre cet utilisateur ?",
            deleteUserTitle: "Supprimer l'utilisateur",
            deleteUserMessage: "Êtes-vous sûr de vouloir supprimer cet utilisateur ?",
            accessDeniedTitle: "Accès refusé",
            accessDeniedMessage: "Vous n'avez pas l'autorisation de voir cette page.",
            authFailedTitle: "Échec de l'authentification",
            authFailedMessage: "Veuillez vous connecter pour continuer.",
            sessionErrorTitle: "Erreur de session",
            sessionErrorMessage: "Impossible de vérifier la session. Veuillez vous reconnecter.",
            confirmDeleteTitle: "Confirmer la suppression",
            confirmDeleteMessage: (userName) => `Êtes-vous sûr de vouloir supprimer ${userName} ? Cette action est irréversible.`,
            generalError: (action) => `Une erreur s'est produite lors de la tentative de ${action} de l'utilisateur.`,
            apiFailed: (message) => message || "La requête API a échoué.",
            successTitle: "Succès",
            sendSuccess: "✅ Message envoyé avec succès !",
            sendError: "❌ Le message n'a pas pu être envoyé. Réessayez plus tard."
          },
          contactForm: {
            title: "Nous contacter",
            nameLabel: "Votre nom",
            emailLabel: "Votre e-mail",
            messageLabel: "Message",
            cancel: "Annuler",
            send: "Envoyer"
          }
        },
          es: { 
      title: "Panel de Administrador",
      loading: "Cargando panel...",
      logout: "Cerrar sesión",
      manageUsers: "Administrar Usuarios",
      manageFiles: "Administrar Archivos",
      filters: "Filtros",
      searchLabel: "Buscar por Nombre/Correo:",
      searchPlaceholder: "Buscar...",
      gradeFilterLabel: "Filtrar por Nivel:",
      allGrades: "Todos los Niveles",
      upperGrade: "Nivel Superior (Clase 5-6)",
      grade: "Nivel",
      juniorHigh: "Secundaria (Form 1-3)",
      seniorHigh: "Preparatoria (SHS 1-3)",
      university: "Universidad",
      level: "Nivel",
      firstYear: "(Primer Año)",
      secondYear: "(Segundo Año)",
      thirdYear: "(Tercer Año)",
      finalYear: "(Último Año)",
      usersHeading: (count) => `Usuarios (${count})`,
      noUsers: "No se encontraron usuarios.",
      role: "Rol",
      school: "Escuela",
      gradeText: "Nivel",
      promote: "Promover",
      demote: "Degradar",
      suspend: "Suspender",
      delete: "Eliminar",
      note: "Nota:",
      noteText: "Solo puedes administrar usuarios de tu escuela.",
      filesHeading: "Archivos de tu escuela",
      noFiles: "No se encontraron archivos para tu escuela.",
      type: "Tipo",
      submittedBy: "Enviado por",
      viewFile: "Ver Archivo",
      alert: { /* similar structure as before */ },
      contactForm: { /* similar structure as before */ }
    },
    tr: {
      title: "Yönetici Paneli",
      loading: "Panel yükleniyor...",
      logout: "Çıkış Yap",
      manageUsers: "Kullanıcıları Yönet",
      manageFiles: "Dosyaları Yönet",
      filters: "Filtreler",
      searchLabel: "İsim/E-posta ile Ara:",
      searchPlaceholder: "Ara...",
      gradeFilterLabel: "Sınıfa Göre Filtrele:",
      allGrades: "Tüm Sınıflar",
      upperGrade: "Üst Sınıf (5-6. Sınıf)",
      grade: "Sınıf",
      juniorHigh: "Ortaokul (1-3. Sınıf)",
      seniorHigh: "Lise (SHS 1-3)",
      university: "Üniversite",
      level: "Seviye",
      firstYear: "(1. Yıl)",
      secondYear: "(2. Yıl)",
      thirdYear: "(3. Yıl)",
      finalYear: "(Son Yıl)",
      usersHeading: (count) => `Kullanıcılar (${count})`,
      noUsers: "Filtrelere uyan kullanıcı bulunamadı.",
      role: "Rol",
      school: "Okul",
      gradeText: "Sınıf",
      promote: "Terfi Etir",
      demote: "Rütbe Düşür",
      suspend: "Askıya Al",
      delete: "Sil",
      note: "Not:",
      noteText: "Sadece kendi okulunuzdaki kullanıcıları yönetebilirsiniz.",
      filesHeading: "Okulunuzun Dosyaları",
      noFiles: "Okulunuz için dosya bulunamadı.",
      type: "Tür",
      submittedBy: "Gönderen",
      viewFile: "Dosyayı Görüntüle",
      alert: { /* same structure */ },
      contactForm: { /* same structure */ }
    },
    ar: {
      title: "لوحة إدارة المسؤول",
      loading: "جارٍ تحميل لوحة التحكم...",
      logout: "تسجيل الخروج",
      manageUsers: "إدارة المستخدمين",
      manageFiles: "إدارة الملفات",
      filters: "الفلاتر",
      searchLabel: "البحث بالاسم/البريد الإلكتروني:",
      searchPlaceholder: "ابحث...",
      gradeFilterLabel: "التصفية حسب الصف:",
      allGrades: "جميع الصفوف",
      upperGrade: "الصفوف العليا (5-6)",
      grade: "الصف",
      juniorHigh: "المرحلة الإعدادية (1-3)",
      seniorHigh: "المرحلة الثانوية (SHS 1-3)",
      university: "الجامعة",
      level: "المستوى",
      firstYear: "(السنة الأولى)",
      secondYear: "(السنة الثانية)",
      thirdYear: "(السنة الثالثة)",
      finalYear: "(السنة الأخيرة)",
      usersHeading: (count) => `المستخدمون (${count})`,
      noUsers: "لم يتم العثور على مستخدمين مطابقين.",
      role: "الدور",
      school: "المدرسة",
      gradeText: "الصف",
      promote: "ترقية",
      demote: "خفض",
      suspend: "تعليق",
      delete: "حذف",
      note: "ملاحظة:",
      noteText: "يمكنك إدارة المستخدمين من مدرستك فقط.",
      filesHeading: "ملفات مدرستك",
      noFiles: "لا توجد ملفات لمدرستك.",
      type: "النوع",
      submittedBy: "تم الإرسال بواسطة",
      viewFile: "عرض الملف",
      alert: { /* same structure */ },
      contactForm: { /* same structure */ }
    },
    ru: {
      title: "Панель Администратора",
      loading: "Загрузка панели...",
      logout: "Выйти",
      manageUsers: "Управление Пользователями",
      manageFiles: "Управление Файлами",
      filters: "Фильтры",
      searchLabel: "Поиск по Имени/Эл.почте:",
      searchPlaceholder: "Поиск...",
      gradeFilterLabel: "Фильтровать по Классу:",
      allGrades: "Все Классы",
      upperGrade: "Старший Класс (5-6)",
      grade: "Класс",
      juniorHigh: "Средняя школа (1-3 класс)",
      seniorHigh: "Старшая школа (SHS 1-3)",
      university: "Университет",
      level: "Уровень",
      firstYear: "(Первый год)",
      secondYear: "(Второй год)",
      thirdYear: "(Третий год)",
      finalYear: "(Последний год)",
      usersHeading: (count) => `Пользователи (${count})`,
      noUsers: "Пользователи не найдены.",
      role: "Роль",
      school: "Школа",
      gradeText: "Класс",
      promote: "Повысить",
      demote: "Понизить",
      suspend: "Приостановить",
      delete: "Удалить",
      note: "Примечание:",
      noteText: "Вы можете управлять только пользователями своей школы.",
      filesHeading: "Файлы вашей школы",
      noFiles: "Файлы для вашей школы не найдены.",
      type: "Тип",
      submittedBy: "Отправлено",
      viewFile: "Просмотреть файл",
      alert: { /* same structure */ },
      contactForm: { /* same structure */ }
    }
      };

      let currentLang = "en";
      const t = (key, ...args) => {
        const value = translations[currentLang][key];
        return typeof value === 'function' ? value(...args) : value;
      };
      
      const updateLang = (lang) => {
        currentLang = lang;
        document.documentElement.lang = lang;
        render(); 
        
        document.getElementById('alert-cancel').textContent = translations[currentLang].alert.cancel;
        document.getElementById('alert-confirm').textContent = translations[currentLang].alert.ok;
        document.getElementById('contact-title').textContent = translations[currentLang].contactForm.title;
        document.getElementById('contact-name-label').textContent = translations[currentLang].contactForm.nameLabel;
        document.getElementById('contact-email-label').textContent = translations[currentLang].contactForm.emailLabel;
        document.getElementById('contact-message-label').textContent = translations[currentLang].contactForm.messageLabel;
        document.getElementById('closeContact').textContent = translations[currentLang].contactForm.cancel;
        document.querySelector('#contactForm button[type="submit"]').textContent = translations[currentLang].contactForm.send;

        document.getElementById('search-term').placeholder = translations[currentLang].searchPlaceholder;
      };


      const fetchAPI = async (url, options = {}) => {
  try {
    const response = await fetch(`${API_BASE_URL}${url}`, {
      ...options,
      credentials: 'include', 
      headers: {
        "Content-Type": "application/json",
      },
    });

    if (response.status === 401) {
      showCustomAlert(
        translations[currentLang].alert.sessionExpiredTitle,
        translations[currentLang].alert.sessionExpiredMessage
      );
      router.replace("/login.html");
      return { ok: false, status: 401 };
    }

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || translations[currentLang].alert.apiFailed(""));
    }

    return response;
  } catch (error) {
    console.error("Fetch error:", error);
    throw error;
  }
};


      const showCustomAlert = (title, message, options) => {
        const modal = document.getElementById("alert-modal");
        const titleEl = document.getElementById("alert-title");
        const messageEl = document.getElementById("alert-message");
        const confirmBtn = document.getElementById("alert-confirm");
        const cancelBtn = document.getElementById("alert-cancel");

        titleEl.textContent = title;
        messageEl.textContent = message;

        confirmBtn.onclick = () => {
          if (options && options.length > 1 && options[1].onPress) {
            options[1].onPress();
          }
          modal.classList.add("hidden");
        };

        if (options && options.length > 0 && (options[0].text === "Cancel" || options[0].text === "Annuler")) {
          cancelBtn.textContent = options[0].text;
          cancelBtn.onclick = () => modal.classList.add("hidden");
          cancelBtn.classList.remove("hidden");
        } else {
          cancelBtn.classList.add("hidden");
        }

        modal.classList.remove("hidden");
      };

      const state = {
        user: null,
        users: [],
        files: [],
        filteredUsers: [],
        roleFilter: "all",
        gradeFilter: "all",
        searchTerm: "",
        activeTab: "users",
        isLoading: true,
      };

   
const renderHeader = () => {
  const container = document.getElementById("app-container");


  const header = `
    <div class="flex justify-between items-center mb-5 pb-2 border-b border-gray-200">
      <div class="flex items-center space-x-4">
        <img src="${state.user?.profile_picture_url || 'https://placehold.co/40x40/94a3b8/ffffff?text=U'}" class="rounded-full w-10 h-10 shadow-md"/>
        <button onclick="router.push('/profile.html')" class="p-2 text-gray-700 hover:text-gray-900"><i class="fas fa-user-circle text-2xl"></i></button>
        <button onclick="router.push('/settings.html')" class="p-2 text-gray-700 hover:text-gray-900"><i class="fas fa-cog text-2xl"></i></button>
      </div>
      <h1 class="text-xl sm:text-2xl font-bold text-gray-800 flex-1 text-center">${translations[currentLang].title}</h1>
      <div class="flex items-center space-x-2">
        <select id="lang-select" class="border rounded-lg px-2 py-1">
          <option value="en" ${currentLang==='en'?'selected':''}>EN</option>
          <option value="fr" ${currentLang==='fr'?'selected':''}>FR</option>
          <option value="es" ${currentLang==='es'?'selected':''}>ES</option>
          <option value="tr" ${currentLang==='tr'?'selected':''}>TR</option>
          <option value="ar" ${currentLang==='ar'?'selected':''}>AR</option>
          <option value="ru" ${currentLang==='ru'?'selected':''}>RU</option>
        </select>
        <button id="logout-button" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 ml-4">
          ${translations[currentLang].logout}
        </button>
      </div>
    </div>
  `;

  container.innerHTML = header; 


  const langDropdown = document.getElementById("lang-select");
  langDropdown.addEventListener("change", (e) => updateLang(e.target.value));

  const tabs = `
    <div class="flex border-b border-gray-300 mb-5">
      <button id="tab-users" class="tab-button ${state.activeTab === "users" ? "active text-blue-600" : "text-gray-600"}" onclick="changeTab('users')">
        ${translations[currentLang].manageUsers}
      </button>
      <button id="tab-files" class="tab-button ${state.activeTab === "files" ? "active text-blue-600" : "text-gray-600"}" onclick="changeTab('files')">
        ${translations[currentLang].manageFiles}
      </button>
    </div>
  `;
  container.innerHTML += tabs;

 
  if (state.activeTab === "users") {
    renderUserManagement();
  } else if (state.activeTab === "files") {
    renderFileManagement();
  }


  document.getElementById("logout-button").addEventListener("click", handleLogout);
};

      const renderUserManagement = () => {
        const container = document.getElementById("app-container");
        const usersSection = document.createElement("div");

        const filtersHtml = `
          <div class="bg-white rounded-xl shadow-md p-4 mb-5">
            <h2 class="text-base sm:text-lg font-semibold text-gray-800">${translations[currentLang].filters}</h2>
            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="search-term" class="block text-gray-700 font-bold mb-2">${translations[currentLang].searchLabel}</label>
                <input type="text" id="search-term" value="${state.searchTerm}" placeholder="${translations[currentLang].searchPlaceholder}" class="w-full p-2 border rounded-lg">
              </div>
              <div>
                <label for="grade-filter" class="block text-gray-700 font-bold mb-2">${translations[currentLang].gradeFilterLabel}</label>
                <div class="picker-container">
                  <select id="grade-filter" class="picker">
                    <option value="all">${translations[currentLang].allGrades}</option>
                    <optgroup label="${translations[currentLang].upperGrade}">
                      <option value="5">${translations[currentLang].grade} 5 (Class 5)</option>
                      <option value="6">${translations[currentLang].grade} 6 (Class 6)</option>
                    </optgroup>
                    <optgroup label="${translations[currentLang].juniorHigh}">
                      <option value="7">${translations[currentLang].grade} 7 (Form 1)</option>
                      <option value="8">${translations[currentLang].grade} 8 (Form 2)</option>
                      <option value="9">${translations[currentLang].grade} 9 (Form 3)</option>
                    </optgroup>
                    <optgroup label="${translations[currentLang].seniorHigh}">
                      <option value="10">${translations[currentLang].grade} 10 (SHS 1)</option>
                      <option value="11">${translations[currentLang].grade} 11 (SHS 2)</option>
                      <option value="12">${translations[currentLang].grade} 12 (SHS 3)</option>
                    </optgroup>
                    <optgroup label="${translations[currentLang].university}">
                      <option value="100">${translations[currentLang].level} 100 ${translations[currentLang].firstYear}</option>
                      <option value="200">${translations[currentLang].level} 200 ${translations[currentLang].secondYear}</option>
                      <option value="300">${translations[currentLang].level} 300 ${translations[currentLang].thirdYear}</option>
                      <option value="400">${translations[currentLang].level} 400 ${translations[currentLang].finalYear}</option>
                    </optgroup>
                  </select>
                </div>
              </div>
            </div>
          </div>
        `;
        usersSection.innerHTML = filtersHtml;

        const usersListHeading = document.createElement("h2");
        usersListHeading.className = "text-lg sm:text-xl font-semibold text-gray-800 mb-4";
        usersListHeading.textContent = translations[currentLang].usersHeading(state.filteredUsers.length);
        usersSection.appendChild(usersListHeading);

        const usersList = document.createElement("div");
        usersList.id = "users-list";

        if (state.filteredUsers.length === 0) {
          const noUsers = document.createElement("p");
          noUsers.className = "text-center italic text-gray-500 py-5";
          noUsers.textContent = translations[currentLang].noUsers;
          usersList.appendChild(noUsers);
        } else {
          state.filteredUsers.forEach(u => {
            const userCard = document.createElement("div");
            userCard.className = "bg-white rounded-xl shadow-md p-4 mb-3 relative";
            userCard.innerHTML = `
              <h3 class="font-bold text-base sm:text-lg mb-1 text-gray-800">
                ${u.firstname} ${u.lastname} (<span class="text-gray-600 font-normal">${u.email}</span>)
              </h3>
              <p class="text-sm text-gray-600 mb-3">
                ${translations[currentLang].role}: ${u.occupation} | ${translations[currentLang].school}: ${u.schoolName || u.teacherSchool || "N/A"}
                ${u.occupation === "student" ? `| ${translations[currentLang].gradeText}: ${u.grade || "N/A"}` : ""}
              </p>
              <div class="flex flex-wrap gap-2">
                <button onclick="manageUser('${u.email}', 'promote')" class="action-button flex-1 bg-green-500 text-white font-bold py-2 px-3 rounded-lg hover:bg-green-600 transition duration-300">${translations[currentLang].promote}</button>
                <button onclick="manageUser('${u.email}', 'demote')" class="action-button flex-1 bg-yellow-500 text-gray-900 font-bold py-2 px-3 rounded-lg hover:bg-yellow-600 transition duration-300">${translations[currentLang].demote}</button>
                <button onclick="manageUser('${u.email}', 'suspend')" class="action-button flex-1 bg-cyan-500 text-white font-bold py-2 px-3 rounded-lg hover:bg-cyan-600 transition duration-300">${translations[currentLang].suspend}</button>
                <button onclick="confirmRemove('${u.email}', '${u.firstname} ${u.lastname}')" class="action-button flex-1 bg-red-500 text-white font-bold py-2 px-3 rounded-lg hover:bg-red-600 transition duration-300">${translations[currentLang].delete}</button>
              </div>
            `;
            usersList.appendChild(userCard);
          });
        }
        usersSection.appendChild(usersList);

        const note = document.createElement("div");
        note.className = "mt-6 p-4 bg-gray-200 rounded-lg border-l-4 border-gray-500";
        note.innerHTML = `<h4 class="font-bold text-base text-gray-900 mb-1">${translations[currentLang].note}</h4><p class="text-sm text-gray-700">${translations[currentLang].noteText}</p>`;
        usersSection.appendChild(note);

        container.appendChild(usersSection);

        document.getElementById("search-term").addEventListener("input", (e) => {
          state.searchTerm = e.target.value;
          filterUsers();
        });
        document.getElementById("grade-filter").addEventListener("change", (e) => {
          state.gradeFilter = e.target.value;
          filterUsers();
        });
        document.getElementById("grade-filter").value = state.gradeFilter;
      };

      const renderFileManagement = () => {
        const container = document.getElementById("app-container");
        const filesSection = document.createElement("div");
        const filesListHeading = document.createElement("h2");
        filesListHeading.className = "text-lg sm:text-xl font-semibold text-gray-800 mb-4";
        filesListHeading.textContent = translations[currentLang].filesHeading;
        filesSection.appendChild(filesListHeading);
        
        const filesList = document.createElement("div");
        filesList.id = "files-list";

        if (state.files.length === 0) {
          const noFiles = document.createElement("p");
          noFiles.className = "text-center italic text-gray-500 py-5";
          noFiles.textContent = translations[currentLang].noFiles;
          filesList.appendChild(noFiles);
        } else {
          state.files.forEach(file => {
            const fileCard = document.createElement("div");
            fileCard.className = "bg-white rounded-xl shadow-md p-4 mb-3";
            fileCard.innerHTML = `
              <h3 class="font-bold text-base sm:text-lg mb-1 text-gray-800">${file.filename}</h3>
              <p class="text-sm text-gray-600">
                ${translations[currentLang].type}: ${file.type} | ${translations[currentLang].submittedBy}: ${file.submittedBy || "N/A"}
              </p>
              <a href="${file.url}" target="_blank" class="mt-2 inline-block text-blue-600 hover:underline">
                <i class="fas fa-eye mr-1"></i>${translations[currentLang].viewFile}
              </a>
            `;
            filesList.appendChild(fileCard);
          });
        }
        filesSection.appendChild(filesList);
        container.appendChild(filesSection);
      };

      const changeTab = (tab) => {
        state.activeTab = tab;
        state.isLoading = true;
        render();
        if (tab === "users") {
          loadUsers();
        } else if (tab === "files") {
          loadFiles();
        }
      };

      const filterUsers = () => {
        let result = state.users;

        if (state.searchTerm) {
          const term = state.searchTerm.toLowerCase();
          result = result.filter(
            (u) =>
              (u.firstname && u.firstname.toLowerCase().includes(term)) ||
              (u.lastname && u.lastname.toLowerCase().includes(term)) ||
              (u.email && u.email.toLowerCase().includes(term))
          );
        }

        if (state.gradeFilter !== "all") {
          result = result.filter((u) => String(u.grade) === state.gradeFilter);
        }

        state.filteredUsers = result;
        render();
      };

      const loadUsers = async () => {
        state.isLoading = true;
        render();
        try {
          const res = await fetchAPI("/global-overseer/users");
          state.users = await res.json();
          filterUsers();
        } catch (err) {
          console.error("Failed to load users", err);
          showCustomAlert(translations[currentLang].alert.title, translations[currentLang].alert.loadUsersError);
        } finally {
          state.isLoading = false;
          render();
        }
      };

      const loadFiles = async () => {
        state.isLoading = true;
        render();
        try {
          const res = await fetchAPI("/admin/my-school-files");
          state.files = await res.json();
        } catch (err) {
          console.error("Failed to load files", err);
          showCustomAlert(translations[currentLang].alert.title, translations[currentLang].alert.loadFilesError);
        } finally {
          state.isLoading = false;
          render();
        }
      };

      const handleLogout = () => {
        showCustomAlert(
          translations[currentLang].alert.logoutConfirmTitle, 
          translations[currentLang].alert.logoutConfirmMessage,
          [
            { text: translations[currentLang].alert.cancel, style: "cancel" },
            {
              text: translations[currentLang].alert.logout,
              onPress: async () => {
                try {
                  await fetchAPI("/users/logout", { method: "POST" });
                  router.replace("/login.html");
                } catch (error) {
                  console.error("Logout failed:", error);
                  showCustomAlert(
                    translations[currentLang].alert.logoutErrorTitle,
                    translations[currentLang].alert.logoutErrorMessage,
                  );
                }
              },
            },
          ]
        );
      };

      const manageUser = async (email, action) => {
        try {
            const endpoint = `/global-overseer/users/${email}/${action}`;
            const res = await fetchAPI(endpoint, { method: "PUT" });
            const data = await res.json();
            if (data.status === 'success') {
                showCustomAlert(translations[currentLang].alert.successTitle, data.message);
                loadUsers();
            } else {
                showCustomAlert(translations[currentLang].alert.title, data.message || translations[currentLang].alert.generalError(translations[currentLang][action]));
            }
        } catch (error) {
            console.error(`Error managing user:`, error);
            showCustomAlert(translations[currentLang].alert.title, translations[currentLang].alert.generalError(translations[currentLang][action]));
        }
      };
      
      const confirmRemove = (email, userName) => {
        showCustomAlert(
            translations[currentLang].alert.confirmDeleteTitle,
            translations[currentLang].alert.confirmDeleteMessage(userName),
            [
                { text: translations[currentLang].alert.cancel, style: "cancel" },
                { 
                    text: translations[currentLang].alert.delete,
                    onPress: async () => {
                        try {
                            const res = await fetchAPI(`/global-overseer/users${email}/delete`, { method: "DELETE" });
                            const data = await res.json();
                            if (data.status === 'success') {
                                showCustomAlert(translations[currentLang].alert.successTitle, data.message);
                                loadUsers();
                            } else {
                                showCustomAlert(translations[currentLang].alert.title, data.message || translations[currentLang].alert.generalError("delete"));
                            }
                        } catch (error) {
                            console.error(`Error deleting user:`, error);
                            showCustomAlert(translations[currentLang].alert.title, translations[currentLang].alert.generalError("delete"));
                        }
                    }
                }
            ]
        );
      };

      window.onload = () => {
        loadUsers();
      };
    </script>
  </body>
</html>