<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartStudentAct - Dashboard</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWMR745QHX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-EWMR745QHX');
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="./images/icon.png"/>
  <link rel="icon" type="image/png" sizes="16x16" href="./images/icon.png"/>
  <link rel="manifest" href="/site.webmanifest"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");
    body { font-family: "Inter", sans-serif; background: #f0f2f5; padding-bottom: 70px; }
    .modal-overlay { background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 50; }
    .modal-overlay.active { display: flex; }
    .tab-active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
    .loading-spinner { display: none; }
    .modal-content { max-height: 90vh; overflow-y: auto; }
    #toast-container { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 60; }
    .toast { animation: fadeinout 4s forwards; opacity: 0; }
    @keyframes fadeinout {
      0% { opacity: 0; transform: translateY(20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- HEADER -->
  <header class="bg-white text-gray-800 p-4 flex justify-between items-center shadow-lg rounded-b-3xl">
    <button id="menu-btn" class="p-2 text-2xl text-blue-600 focus:outline-none" aria-label="Open navigation menu"><i class="fas fa-bars"></i></button>
    <span data-i18n="nav_title" class="text-xl font-bold flex-1 text-center">📘 SmartStudentAct</span>
    <button id="logout-btn" class="bg-red-500 py-2 px-4 rounded-full font-bold shadow-md text-white hover:bg-red-600 transition-colors"><span data-i18n="logout">Logout</span></button>
  </header>

  <!-- MAIN CONTENT -->
  <main class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-4xl mx-auto">

      <h1 data-i18n="welcome_heading" class="text-3xl sm:text-4xl font-extrabold text-center text-gray-800 mt-8 mb-4">Welcome to SmartStudentAct</h1>
      <p data-i18n="welcome_text" class="text-lg text-center text-gray-600 mb-8">Your learning & financial companion</p>

      <form id="profile-form" class="mb-4">
  <input type="file" id="profile-photo" name="profilePhoto" accept="image/*" />
  <button type="submit">Upload</button>
</form>
<img id="profile-preview" src="/default-avatar.png" class="w-24 h-24 rounded-full" />

      <!-- ASSIGNMENTS -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="assignments_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">📚 Assignments</h2>
        <button id="add-assignment-btn" data-i18n="add_assignment_btn" class="bg-green-500 text-white py-3 px-6 rounded-full font-bold w-full mb-4 shadow-lg hover:bg-green-600 transition-colors">+ Add Assignment</button>
        <div id="assignments-list" class="space-y-4">
          <p data-i18n="no_assignments" class="italic text-gray-500 text-center">No assignments added yet.</p>
        </div>
        <div id="assignments-loading" class="text-center mt-4 loading-spinner"><i class="fas fa-spinner fa-spin text-3xl text-gray-500"></i></div>
      </section>

      <!-- QUIZZES -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="quizzes_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">📝 Quizzes</h2>
        <div id="quizzes-list" class="space-y-4">
          <p data-i18n="no_quizzes" class="italic text-gray-500 text-center">No quizzes assigned yet.</p>
        </div>
        <div id="quizzes-loading" class="text-center mt-4 loading-spinner"><i class="fas fa-spinner fa-spin text-3xl text-gray-500"></i></div>
      </section>

      <!-- BUDGET -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="budget_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">💰 Budget</h2>
        <button id="add-budget-btn" data-i18n="add_expense_btn" class="bg-green-500 text-white py-3 px-6 rounded-full font-bold w-full mb-4 shadow-lg hover:bg-green-600 transition-colors">+ Add Expense</button>
        <div id="budget-list" class="space-y-4">
          <p data-i18n="no_budget" class="italic text-gray-500 text-center">No budget entries yet.</p>
        </div>
        <div id="budget-loading" class="text-center mt-4 loading-spinner"><i class="fas fa-spinner fa-spin text-3xl text-gray-500"></i></div>
      </section>

      <!-- WEEKLY GOAL -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="weekly_goal_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">🎯 Weekly Goal</h2>
        <div class="space-y-4">
          <input id="goal-input" type="text" data-i18n-placeholder="goal_placeholder" placeholder="Your weekly goal" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 text-base"/>
          <p id="goal-error" class="text-red-500 text-sm hidden"></p>
          <button id="save-goal-btn" data-i18n="save_goal_btn" class="bg-blue-500 text-white py-3 px-6 rounded-full font-bold w-full shadow-lg hover:bg-blue-600 transition-colors">Save Goal</button>
          <p id="saved-goal-text" class="text-green-600 font-bold text-center mt-2 hidden"></p>
        </div>
      </section>

      <!-- AI INSIGHTS -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <div class="flex items-center justify-between mb-4">
          <h2 data-i18n="ai_insights_title" class="text-2xl font-semibold text-gray-800 flex items-center">🤖 AI Insights</h2>
          <div class="flex items-center">
            <label data-i18n="subscribed_label" for="subscription-toggle" class="text-sm text-gray-500 mr-2">Subscribed?</label>
            <input type="checkbox" id="subscription-toggle" class="form-checkbox h-5 w-5 text-blue-600 rounded"/>
          </div>
        </div>
        <button id="generate-insights-btn" data-i18n="generate_insights_btn" class="bg-purple-500 text-white py-3 px-6 rounded-full font-bold w-full mb-4 shadow-lg hover:bg-purple-600 transition-colors">Generate Insights</button>
        <div id="insights-container" class="space-y-4">
          <p data-i18n="insights_placeholder" id="insights-placeholder" class="italic text-gray-500 text-center">Click "Generate Insights" to get personalized feedback on your academic and financial goals.</p>
          <div id="insights-loading" class="text-center mt-4 loading-spinner"><i class="fas fa-spinner fa-spin text-3xl text-gray-500"></i></div>
          <div id="insights-content" class="bg-gray-50 p-4 rounded-xl shadow-inner hidden"></div>
        </div>
      </section>

      <!-- REWARDS -->
      <section id="rewards" class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="rewards_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">🏆 Rewards</h2>
        <div id="rewards-list" class="space-y-4"><p data-i18n="no_rewards" class="italic text-gray-500 text-center">No rewards yet. Keep up the great work!</p></div>
        <div class="text-center mt-4 loading-spinner"><i class="fas fa-spinner fa-spin text-3xl text-gray-500"></i></div>
      </section>

      <!-- ANALYTICS -->
      <section class="bg-white rounded-3xl shadow-xl p-6 mb-6 transform hover:scale-105 transition-transform duration-300">
        <h2 data-i18n="analytics_title" class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">📊 Analytics</h2>
        <div class="w-full h-64"><canvas id="analytics-chart"></canvas></div>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="text-center text-gray-500 text-sm mt-8 mb-4">
    <span data-i18n="footer_text">&copy; 2025 SmartStudentAct – Empowering Students Globally.</span>
  </footer>

  <!-- NAV BAR -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-4px_12px_-1px_rgba(0,0,0,0.1)] py-2 px-4 rounded-t-3xl z-40">
    <div class="flex justify-around items-center h-full">
      <a href="./students.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="dashboard">
        <i class="fas fa-home text-2xl mb-1"></i><span data-i18n="dashboard_tab" class="text-xs font-medium">Dashboard</span>
      </a>
      <a href="./task-completed.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="completed">
        <i class="fas fa-check-circle text-2xl mb-1"></i><span data-i18n="completed_tab" class="text-xs font-medium">Completed</span>
      </a>
      <a href="./teachers-list.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="teachers">
        <i class="fas fa-chalkboard-teacher text-2xl mb-1"></i><span data-i18n="teachers_tab" class="text-xs font-medium">Teachers</span>
      </a>
      <a href="./student_quiz.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="quiz">
        <i class="fas fa-wallet text-2xl mb-1"></i><span data-i18n="quiz_tab" class="text-xs font-medium">Quizzes</span>
      </a>
      <a href="AI Essay Checker.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="ai-checker">
        <i class="fas fa-robot text-2xl mb-1"></i><span data-i18n="ai_checker_tab" class="text-xs font-medium">🤖AI Checker</span>
      </a>
      <a href="./profile.html" class="tab-link flex flex-col items-center justify-center p-2 text-gray-500 hover:text-blue-500 transition-colors" data-tab="profile">
        <i class="fas fa-user-circle text-2xl mb-1"></i><span data-i18n="profile_tab" class="text-xs font-medium">👤Profile</span>
      </a>
    </div>
  </nav>

  <!-- ADD ASSIGNMENT MODAL -->
  <div id="add-assignment-modal" class="modal-overlay">
    <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl p-6 modal-content relative">
      <button class="absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl" onclick="closeModal('add-assignment-modal')">&times;</button>
      <h3 class="text-xl font-bold mb-4" data-i18n="add_assignment_modal_title">Add Assignment</h3>
      <input type="text" placeholder="Assignment Name" id="assignment-name" class="w-full mb-3 px-4 py-2 border rounded-xl focus:outline-none"/>
      <textarea placeholder="Description" id="assignment-desc" class="w-full mb-3 px-4 py-2 border rounded-xl focus:outline-none"></textarea>
      <button class="bg-green-500 text-white py-2 px-6 rounded-full w-full font-bold hover:bg-green-600" onclick="saveAssignment()">Save Assignment</button>
    </div>
  </div>

  <!-- ADD BUDGET MODAL -->
  <div id="budget-modal" class="modal-overlay">
    <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl p-6 modal-content relative">
      <button class="absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl" onclick="closeModal('budget-modal')">&times;</button>
      <h3 class="text-xl font-bold mb-4" data-i18n="add_budget_modal_title">Add Budget</h3>
      <input type="text" placeholder="Expense Name" id="expense-name" class="w-full mb-3 px-4 py-2 border rounded-xl focus:outline-none"/>
      <input type="number" placeholder="Amount" id="expense-amount" class="w-full mb-3 px-4 py-2 border rounded-xl focus:outline-none"/>
      <button class="bg-green-500 text-white py-2 px-6 rounded-full w-full font-bold hover:bg-green-600" onclick="saveBudget()">Save Expense</button>
    </div>
  </div>

  <!-- MENU MODAL -->
  <div id="menu-modal" class="modal-overlay">
      <div id="menu-content" class="bg-white h-full w-64 p-6 shadow-2xl transition-transform duration-300 ease-in-out transform -translate-x-full">
          <button id="close-menu-btn" class="text-gray-500 text-2xl absolute top-4 right-4">&times;</button>
          <h2 class="text-xl font-bold mb-6">Menu</h2>
          <nav>
              <ul class="space-y-4">
                  <li><a href="./students.html" class="text-blue-600 font-semibold hover:underline">Dashboard</a></li>
                  <li><a href="./financial.html" class="text-blue-600 font-semibold hover:underline">Financial</a></li>
                  <li><a href="./settings.html" class="hover:underline">Settings</a></li>
                  <li><a href="./rewards.html" class="hover:underline">Rewards</a></li>
                  <li><button id="menu-logout-btn" class="text-red-500 font-semibold hover:underline">Logout</button></li>
              </ul>
          </nav>
      </div>
  </div>

  <!-- TOAST CONTAINER -->
  <div id="toast-container"></div>
  
  <!-- LANGUAGE SWITCHER -->
  <div id="language-switcher" class="flex justify-center my-4 relative">
    <select id="lang-select" class="px-3 py-2 bg-white border border-gray-300 rounded-full shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8 cursor-pointer text-sm">
      <option value="en">EN - English</option>
      <option value="fr">FR - Français</option>
      <option value="es">ES - Español</option>
      <option value="tr">TR - Türkçe</option>
      <option value="ar">AR - العربية</option>
      <option value="ru">RU - Русский</option>
    </select>
    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
      <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
    </div>
  </div>

  <!-- TRANSLATION SCRIPT -->
  <script src="translate.js"></script>

<script>
const API_BASE_URL = "https://smartstudentact.onrender.com/api";

document.addEventListener("DOMContentLoaded", async () => {
  // 1. Language
  let currentLang = "en";
  const dashboardName = "students";
  translatePage(dashboardName, currentLang);
  document.getElementById("lang-select").addEventListener("change", (e) => {
    currentLang = e.target.value;
    translatePage(dashboardName, currentLang);
  });

  // 2. DOM Elements
  const DOMElements = {
    logoutBtn: document.getElementById('logout-btn'),
    menuLogoutBtn: document.getElementById('menu-logout-btn'),
    closeMenuBtn: document.getElementById('close-menu-btn'),
    menuContent: document.getElementById('menu-content'),
    saveGoalBtn: document.getElementById('save-goal-btn'),
    goalInput: document.getElementById('goal-input'),
    savedGoalText: document.getElementById('saved-goal-text'),
    assignmentsList: document.getElementById('assignments-list'),
    budgetList: document.getElementById('budget-list'),
    insightsContent: document.getElementById('insights-content'),
    insightsPlaceholder: document.getElementById('insights-placeholder'),
    generateInsightsBtn: document.getElementById('generate-insights-btn'),
    chartCanvas: document.getElementById('analytics-chart'),
    profileForm: document.getElementById('profile-form'),
    profilePic: document.getElementById('profile-pic'),
  };

  // 3. Helpers
  function openModal(id) { document.getElementById(id).classList.add('active'); }
  function closeModal(id) { document.getElementById(id).classList.remove('active'); }

  function showToast(message, type = "info") {
    const container = document.getElementById("toast-container");
    const toast = document.createElement("div");
    const colors = { success:"bg-green-500", error:"bg-red-500", info:"bg-blue-500", warning:"bg-yellow-500" };
    toast.className = `toast ${colors[type] || colors.info} text-white px-4 py-2 rounded-full shadow-lg`;
    toast.innerText = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
  }

  async function fetchWithAuth(endpoint, options={}) {
    const res = await fetch(`${API_BASE_URL}${endpoint}`, {
      ...options,
      credentials: "include"
    });
    if (!res.ok) throw new Error((await res.json()).message || "Request failed");
    return res.json();
  }

  async function checkAuthentication() {
    try {
      await fetchWithAuth("/auth/check");
      return true;
    } catch {
      showToast("Please login first.", "error");
      setTimeout(()=>window.location.href="/login.html",1500);
      return false;
    }
  }

  // 4. Handlers
  async function handleSaveAssignment() {
    const name = document.getElementById('assignment-name').value.trim();
    const desc = document.getElementById('assignment-desc').value.trim();
    if (!name) return showToast("Enter assignment name","warning");

    try {
      await fetchWithAuth("/student/submissions", {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ title:name, description:desc })
      });
      showToast("Assignment submitted!","success");
      closeModal("add-assignment-modal");
      fetchAssignments();
    } catch(e){ showToast(e.message,"error"); }
  }

  async function handleSaveBudget() {
    const name = document.getElementById('expense-name').value.trim();
    const amount = document.getElementById('expense-amount').value.trim();
    if (!name || !amount || isNaN(amount)) return showToast("Enter valid budget","warning");

    try {
      await fetchWithAuth("/add-entry", {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ description:name, amount:parseFloat(amount) })
      });
      showToast("Budget entry saved!","success");
      closeModal("budget-modal");
      fetchBudget();
    } catch(e){ showToast(e.message,"error"); }
  }

  async function handleSaveGoal() {
    const goalText = DOMElements.goalInput.value.trim();
    if (!goalText) return showToast("Please enter a goal","warning");

    try {
      await fetchWithAuth("/goals", {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ description:goalText, type:"academic" })
      });
      showToast("Goal saved 🎯","success");
      fetchGoal();
    } catch(e){ showToast(e.message,"error"); }
  }

  async function handleLogout() {
    try {
      await fetch(`${API_BASE_URL}/users/logout`,{ method:"POST", credentials:"include" });
      showToast("Logged out","info");
      setTimeout(()=>window.location.href="/login.html",1000);
    } catch { showToast("Logout failed","error"); }
  }

  async function handleProfileUpload(e) {
    e.preventDefault();
    const formData = new FormData(DOMElements.profileForm);

    try {
      const res = await fetch(`${API_BASE_URL}/profile/upload-photo`, {
        method:"POST",
        body: formData,
        credentials: "include"
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || "Upload failed");
      DOMElements.profilePic.src = data.imageUrl;
      showToast("Profile updated!","success");
    } catch(e){ showToast(e.message,"error"); }
  }

  async function handleGenerateInsights() {
    try {
      const advice = await fetchWithAuth("/advice");
      DOMElements.insightsPlaceholder.classList.add("hidden");
      DOMElements.insightsContent.classList.remove("hidden");
      DOMElements.insightsContent.innerText = advice.message || "No advice received.";
    } catch(e){ showToast(e.message,"error"); }
  }

  // 5. Fetch + Render
  async function fetchAssignments(){
    try {
      const assignments = await fetchWithAuth("/student/assignments");
      DOMElements.assignmentsList.innerHTML = assignments.map(a =>
        `<li class="p-2 border-b">${a.title} - ${a.description || ""}</li>`
      ).join("") || "<li>No assignments</li>";
    } catch(e){ showToast(e.message,"error"); }
  }

  async function fetchBudget(){
    try {
      const entries = await fetchWithAuth("/entries");
      DOMElements.budgetList.innerHTML = entries.map(e =>
        `<li class="p-2 border-b">${e.description}: $${e.amount}</li>`
      ).join("") || "<li>No budget entries</li>";
    } catch(e){ showToast(e.message,"error"); }
  }

  async function fetchGoal(){
    try {
      const goals = await fetchWithAuth("/goals");
      DOMElements.savedGoalText.innerText = goals.length ? goals[0].description : "No goals yet.";
    } catch(e){ showToast(e.message,"error"); }
  }

  // 6. Init
  if (await checkAuthentication()) {
    fetchAssignments(); fetchBudget(); fetchGoal();
  }

  DOMElements.saveGoalBtn.addEventListener("click", handleSaveGoal);
  DOMElements.generateInsightsBtn.addEventListener("click", handleGenerateInsights);
  DOMElements.logoutBtn.addEventListener("click", handleLogout);
  DOMElements.menuLogoutBtn.addEventListener("click", handleLogout);
  DOMElements.profileForm.addEventListener("submit", handleProfileUpload);

  window.saveAssignment = handleSaveAssignment;
  window.saveBudget = handleSaveBudget;
});
</script>
  </body>
</html>
